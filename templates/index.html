<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>My Embedded Shopify App</title>
    
    <!-- Load Shopify App Bridge (version 2) -->
    <script src="https://unpkg.com/@shopify/app-bridge@2"></script>
    <!-- (Optional) App Bridge utilities for navigation, etc. -->
    <script src="https://unpkg.com/@shopify/app-bridge-utils"></script>
  </head>
  <body>
    <h1>Welcome to My Embedded Shopify App!</h1>

    <!-- A paragraph to show shop info or status -->
    <p id="status"></p>

    <!-- Button that triggers OAuth installation link -->
    <button id="authorizeBtn">Authorize Shop Access</button>

    <script>
      // 1. Parse the 'shop' param from the URL query string.
      const params = new URLSearchParams(window.location.search);
      const shopOrigin = params.get('shop');

      // 2. Initialize App Bridge if we have a 'shop' param.
      //    Replace 'YOUR_API_KEY' with your actual Shopify API Key from Partner Dashboard.
      if (shopOrigin) {
        const app = window['app-bridge'].createApp({
          apiKey: 'YOUR_API_KEY',
          shopOrigin: shopOrigin,
          forceRedirect: true  // ensures top-level redirect if needed
        });

        // Display a small status message
        const statusEl = document.getElementById('status');
        statusEl.innerText = `Shop: ${shopOrigin}`;

        // 3. Attach a click handler to the "Authorize Shop Access" button
        const authorizeBtn = document.getElementById('authorizeBtn');
        authorizeBtn.addEventListener('click', () => {
          // Build the OAuth authorize URL
          // scope can be "read_products", "write_products", etc. 
          // redirect_uri must match what's in your Partner Dashboard's Allowed redirection URLs.
          const scope = "read_products";
          const redirectUri = "https://yourapp.com/auth/callback"; 
          //   ^^^^^ Replace with your actual callback route
          
          // Full authorize URL:
          // https://{shop}.myshopify.com/admin/oauth/authorize
          //   ?client_id=YOUR_API_KEY
          //   &scope=...
          //   &redirect_uri=...
          const authorizeUrl = `https://${shopOrigin}/admin/oauth/authorize` +
            `?client_id=YOUR_API_KEY` +
            `&scope=${scope}` +
            `&redirect_uri=${encodeURIComponent(redirectUri)}`;

          // Redirect the browser to start the OAuth install flow
          window.location.href = authorizeUrl;
        });

      } else {
        // No shop param found => show a quick message
        document.getElementById('status').innerText =
          'No shop parameter found in URL. Please include ?shop=my-shop.myshopify.com';
      }
    </script>
  </body>
</html>

